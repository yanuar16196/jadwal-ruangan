<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jadwal Penggunaan Ruangan</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
    }

    /* HEADER */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to right, #0a4c7d, #0a3a5d);
      color: white;
      padding: 20px 40px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 25px;
    }

    /* LOGO */
    .logo {
      height: 140px;
      width: auto;
      object-fit: contain;
    }

    .title {
      display: flex;
      flex-direction: column;
    }

    .title h1 {
      margin: 0;
      font-size: 2.8rem;
    }

    .title p {
      margin: 0;
      font-size: 1.3rem;
      font-weight: 300;
    }

    .clock {
      text-align: right;
      font-size: 2rem;
    }

    .clock .date {
      display: block;
      font-size: 1.2rem;
      font-weight: normal;
    }

    /* TABEL */
    table {
      width: 95%;
      margin: 20px auto;
      border-collapse: collapse;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      background: white;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
    }

    th {
      background-color: #0a4c7d;
      color: white;
      font-size: 1.1rem;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:hover {
      background-color: #f1f1f1;
    }

    /* FOOTER INFO */
    .footer-info {
      background: #111;
      color: yellow;
      font-weight: bold;
      text-align: center;
      padding: 12px;
      position: fixed;
      bottom: 0;
      width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <div class="header-left">
      <img src="paroki2.png" alt="Logo" class="logo paroki">
      <div class="title">
        <h1>Jadwal Penggunaan Ruangan</h1>
        <p>Paroki Santa Maria Assumpta Klaten</p>
      </div>
    </div>
    <div class="clock" id="clock"></div>
  </div>

  <!-- TABEL -->
  <table id="jadwal">
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Hari</th>
        <th>Jam</th>
        <th>Kegiatan</th>
        <th>Ruangan</th>
        <th>Penanggung Jawab</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="6">Memuat data...</td></tr>
    </tbody>
  </table>

  <!-- FOOTER INFO -->
  <div class="footer-info" id="pengumuman">
    Memuat pengumuman...
  </div>

  <!-- SCRIPT -->
  <script>
  /* === CONFIG URL (ubah sesuai spreadsheet) === */
  const urlJadwal = "PASTE_URL_CSV_JADWAL_DI_SINI";
  const urlPengumuman = "PASTE_URL_CSV_PENGUMUMAN_DI_SINI";

  /* === SETTINGS === */
  const rowsPerPage = 10;         // baris per halaman tabel
  const slideIntervalMs = 30000;  // pindah halaman tiap 30 detik
  const reloadIntervalMs = 30000; // refresh data tiap 30 detik

  /* CSV parser */
  function parseCSV(text){
    const lines=text.split(/\r?\n/).filter(l=>l.trim()!=="");
    return lines.map(line=>{
      const row=[]; let cur="",inQ=false;
      for(let i=0;i<line.length;i++){
        const c=line[i];
        if(c=='"'){ if(inQ && line[i+1]=='"'){cur+='"'; i++;} else inQ=!inQ; }
        else if(c=="," && !inQ){ row.push(cur); cur=""; }
        else cur+=c;
      }
      row.push(cur); return row;
    });
  }

  /* Hari dari tanggal */
  function getHari(dateStr){
    if(!dateStr) return "";
    if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateStr)){
      const [d,m,y]=dateStr.split("/");
      const tgl=new Date(`${y}-${m}-${d}`);
      return !isNaN(tgl)?tgl.toLocaleDateString("id-ID",{weekday:"long"}):"";
    }
    const d=new Date(dateStr);
    return !isNaN(d)?d.toLocaleDateString("id-ID",{weekday:"long"}):"";
  }

  /* Slideshow Jadwal */
  let jadwalData = [];
  let currentPage = 0;
  let slideTimer;

  function renderPage(page){
    const tbody=document.querySelector("#jadwal tbody");
    tbody.innerHTML="";
    const start = page * rowsPerPage;
    const end = start + rowsPerPage;
    const slice = jadwalData.slice(start,end);
    if(slice.length===0){
      tbody.innerHTML=`<tr><td colspan="6" style="text-align:center;padding:20px">Tidak ada data</td></tr>`;
      return;
    }
    slice.forEach(r=>{
      if(r.length<5) return;
      const hari=getHari(r[0]);
      tbody.innerHTML+=`
        <tr>
          <td>${r[0]}</td>
          <td>${hari}</td>
          <td>${r[1]}</td>
          <td style="text-align:left;padding-left:12px">${r[2]}</td>
          <td>${r[3]}</td>
          <td>${r[4]}</td>
        </tr>`;
    });
  }

  function startSlideshow(){
    if(slideTimer) clearInterval(slideTimer);
    renderPage(currentPage);
    slideTimer=setInterval(()=>{
      currentPage++;
      if(currentPage * rowsPerPage >= jadwalData.length){
        currentPage=0;
      }
      renderPage(currentPage);
    }, slideIntervalMs);
  }

  /* Load Jadwal */
  function loadJadwal(){
    fetch(urlJadwal).then(r=>r.text()).then(txt=>{
      const data=parseCSV(txt);
      if(data.length<=1) return;
      data.shift();
      jadwalData=data;
      currentPage=0;
      startSlideshow();
    }).catch(err=>{
      console.error(err);
      document.querySelector("#jadwal tbody").innerHTML="<tr><td colspan=6>Gagal memuat data</td></tr>";
    });
  }

  /* Load Pengumuman */
  function loadPengumuman(){
    fetch(urlPengumuman).then(r=>r.text()).then(txt=>{
      const data=parseCSV(txt);
      data.shift();
      const pesan=data.map(r=>(r[0]||"").trim()).filter(Boolean);
      document.getElementById("pengumuman").textContent=pesan.length?pesan.join(" â€¢ "):"Tidak ada pengumuman";
    }).catch(err=>{
      document.getElementById("pengumuman").textContent="Gagal memuat pengumuman";
    });
  }

  /* Clock */
  function startClock(){
    const days=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
    const months=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
    function update(){
      const n=new Date();
      const jam=n.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"});
      const tgl=`${days[n.getDay()]}, ${n.getDate()} ${months[n.getMonth()]} ${n.getFullYear()}`;
      document.getElementById("clock").innerHTML=`${jam}<span class="date">${tgl}</span>`;
    }
    update(); setInterval(update,1000);
  }

  /* Init */
  startClock();
  loadJadwal();
  loadPengumuman();

  setInterval(loadJadwal, reloadIntervalMs);
  setInterval(loadPengumuman, reloadIntervalMs);
  </script>
</body>
</html>

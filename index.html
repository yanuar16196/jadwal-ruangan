<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jadwal Penggunaan Ruangan - Paroki</title>
  <style>
    :root{
      --header-bg: #0e4a7a;
      --header-accent: rgba(2,57,107,0.95);
      --table-header: rgba(0,0,0,0.66);
      --cell-dark: rgba(0,0,0,0.66);
      --cell-dark-2: rgba(0,0,0,0.78);
      --accent-yellow: #ffea00;
    }

    html,body{height:100vh; overflow: hidden; margin:0;font-family:"Segoe UI", Roboto, Arial; color:#fff;background:#111;}
    body{
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
      
    }

    /* HEADER */
    header{
      background: var(--header-bg);
      padding:20px 40px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-radius: 0 0 16px 16px;
      box-shadow:0 4px 12px rgba(0,0,0,0.4);
      flex-shrink: 0;
    }
  
    .logo{
      height:100px; width:auto; 
    }
    h1{
      margin:0; font-size:56px; font-weight:800;
    }
    .subtitle{ margin:6px; font-size:26px; color:#d6e7ff; }

    /* clock */
    #clock{
      text-align:right;
      font-weight:700;
      font-size:38px;
      min-width:280px;
      color:#fff;
    }
    #clock .date{ font-weight:500; font-size:25px; color:#dbeeff; display:block; margin-top:8px; }

    /* table container */
    .table-container{
      flex:1;
      display:flex;
      justify-content: center;
      padding: 10px 40px;
      overflow: hidden; /* tidak bisa scroll */
    }
    .table-wrapper {
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    }

    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
      color:#fff;
      font-size:26px;
      background:transparent;
    }
    thead th{
      background: var(--table-header);
      padding: 18px;
      font-size: 30px;
      font-weight: 700;
    }
    tbody td{
      padding:16px 14px;
      font-size:28px;
      vertical-align:middle;
    }

    tbody tr:nth-child(odd) td{ background: var(--cell-dark); }
    tbody tr:nth-child(even) td{ background: var(--cell-dark-2); }

    .table-wrapper{
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 6px 18px rgba(0,0,0,0.5);
    }

    /* footer running text */
    .footer-note{
     background: rgba(0,0,0,0.9);
    color: var(--accent-yellow);
    font-weight: 800;
    font-size: 32px;
    text-align: center;
    padding: 20px;
    flex-shrink: 0;
    }

  </style>
</head>
<body>
  <header>
    <div class="left">
      <img src="paroki2.png" class="logo" alt="Logo Paroki">
      <div class="title">
        <h1>Jadwal Penggunaan Ruangan</h1>
        <div class="subtitle">Paroki Santa Maria Assumpta Klaten</div>
      </div>
    </div>
    <div id="clock">--:--:--<span class="date">Memuat tanggal...</span></div>
  </header>

  <div class="table-container">
    <div class="table-wrapper">
      <table id="jadwal">
        <thead>
          <tr>
            <th style="width:14%">Tanggal</th>
            <th style="width:12%">Hari</th>
            <th style="width:10%">Jam</th>
            <th style="width:38%">Kegiatan</th>
            <th style="width:13%">Ruangan</th>
            <th style="width:13%">Penanggung Jawab</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="6" style="padding:24px;text-align:center">Memuat data...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="footer-note" id="pengumuman">Memuat pengumuman...</div>

<script>
/* === CONFIG URL GOOGLE SHEETS === */
const urlJadwal = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSIcQ-QfZhH-MGrWehxKCo8H-yyq0Ayt2ARrVr-ydGXtQ4xgu97_Rc3qccaquiqWDYO0ywKkWKrWRXi/pub?gid=0&single=true&output=csv";
const urlPengumuman = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSIcQ-QfZhH-MGrWehxKCo8H-yyq0Ayt2ARrVr-ydGXtQ4xgu97_Rc3qccaquiqWDYO0ywKkWKrWRXi/pub?gid=563346649&single=true&output=csv";

/* Konfigurasi slideshow */
const rowsPerPage = 10;
const slideIntervalMs = 8000;
let jadwalRows = [];
let currentPage = 0;
let slideTimer = null;

/* CSV Parser */
function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
  const out = [];
  for(const line of lines){
    const row = [];
    let cur = "", inQuote=false;
    for(let j=0;j<line.length;j++){
      const ch = line[j];
      if(ch === '"'){
        if(inQuote && line[j+1] === '"'){ cur += '"'; j++; }
        else inQuote = !inQuote;
      } else if(ch === ',' && !inQuote){
        row.push(cur); cur="";
      } else cur+=ch;
    }
    row.push(cur);
    out.push(row);
  }
  return out;
}

/* Hari dari tanggal */
function getHariFromDateString(s){
  if(!s) return "";
  s=s.trim();
  if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(s)){
    const [d,m,y] = s.split("/");
    const date=new Date(`${y}-${m}-${d}`);
    if(isNaN(date)) return "";
    return date.toLocaleDateString("id-ID",{weekday:"long"});
  }
  const d=new Date(s);
  if(!isNaN(d)) return d.toLocaleDateString("id-ID",{weekday:"long"});
  return "";
}

/* Render page */
function renderPage(pageIndex){
  const tbody=document.querySelector("#jadwal tbody");
  if(jadwalRows.length===0){
    tbody.innerHTML="<tr><td colspan='6' style='padding:20px;text-align:center'>Tidak ada data</td></tr>";
    return;
  }
  const start=pageIndex*rowsPerPage;
  const slice=jadwalRows.slice(start,start+rowsPerPage);
  let html="";
  for(const r of slice){
    const tanggal=r[0]||"", jam=r[1]||"", acara=r[2]||"", ruang=r[3]||"", pic=r[4]||"";
    const hari=getHariFromDateString(tanggal);
    html+=`<tr>
      <td>${tanggal}</td>
      <td>${hari}</td>
      <td>${jam}</td>
      <td style="text-align:left;padding-left:18px">${acara}</td>
      <td>${ruang}</td>
      <td>${pic}</td>
    </tr>`;
  }
  tbody.innerHTML=html;
}

/* Slideshow */
function startSlideshow(){
  if(slideTimer){ clearInterval(slideTimer); slideTimer=null; }
  if(jadwalRows.length<=rowsPerPage){
    renderPage(0);
    return;
  }
  slideTimer=setInterval(()=>{
    currentPage++;
    const totalPages=Math.ceil(jadwalRows.length/rowsPerPage);
    if(currentPage>=totalPages) currentPage=0;
    renderPage(currentPage);
  },slideIntervalMs);
  currentPage=0; renderPage(0);
}

/* Load jadwal */
function loadJadwal(){
  fetch(urlJadwal).then(r=>r.text()).then(txt=>{
    const parsed=parseCSV(txt);
    if(parsed.length===0){ jadwalRows=[]; startSlideshow(); return; }
    const first=parsed[0][0]||"";
    if(!/^\d/.test(first)) parsed.shift();
    jadwalRows=parsed.filter(r=>r.some(cell=>(cell||"").trim()!==""));
    startSlideshow();
  }).catch(err=>{
    console.error("Error load jadwal:",err);
    document.querySelector("#jadwal tbody").innerHTML="<tr><td colspan='6' style='text-align:center'>Gagal memuat data</td></tr>";
  });
}

/* Load pengumuman */
function loadPengumuman(){
  fetch(urlPengumuman).then(r=>r.text()).then(txt=>{
    const parsed=parseCSV(txt);
    let rows=parsed;
    const first=rows[0]&&rows[0][0]?rows[0][0]:"";
    if(first && (first.toLowerCase().includes("judul")||first.toLowerCase().includes("pengumuman"))) rows.shift();
    const texts=rows.map(r=>(r[0]||"").trim()).filter(Boolean);
    document.getElementById("pengumuman").textContent=texts.length?texts.join(" â€¢ "):"Tidak ada pengumuman";
  }).catch(err=>{
    console.error("Error pengumuman:",err);
    document.getElementById("pengumuman").textContent="Gagal memuat pengumuman";
  });
}

/* Clock */
function startClock(){
  const days=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
  const months=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
  function update(){
    const n=new Date();
    const t=n.toLocaleTimeString('id-ID',{hour:"2-digit",minute:"2-digit",second:"2-digit"});
    const dateStr=`${days[n.getDay()]}, ${String(n.getDate()).padStart(2,'0')} ${months[n.getMonth()]} ${n.getFullYear()}`;
    document.getElementById("clock").innerHTML=`${t}<span class="date">${dateStr}</span>`;
  }
  update(); setInterval(update,1000);
}

/* INIT */
startClock();
loadJadwal();
loadPengumuman();
setInterval(loadJadwal,30000);   // update setiap 30 detik
setInterval(loadPengumuman,30000);
</script>
</body>
</html>



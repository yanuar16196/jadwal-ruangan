<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jadwal Penggunaan Ruangan - Paroki</title>
  <style>
    :root{
      --header-bg: #0e4a7a;
      --table-header: rgba(2,57,107,0.95);
      --cell-dark: rgba(0,0,0,0.66);
      --cell-dark-2: rgba(0,0,0,0.78);
      --accent-yellow: #ffea00;
    }

    html,body{margin:0;height:100%;font-family:"Segoe UI",Arial,sans-serif;background:#111;color:#fff;}
    body{display:flex;flex-direction:column;min-height:100vh;}

    /* HEADER */
    header{
      background: linear-gradient(180deg,var(--header-bg), #0b3f63);
      padding:20px 30px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 2px 6px rgba(0,0,0,0.5);
    }
    .left{display:flex;align-items:center;gap:20px;}
    .logo{height:120px;width:auto;max-width:15vw;}
    h1{margin:0;font-size:42px;font-weight:800;}
    .subtitle{margin-top:6px;font-size:20px;color:#d6e7ff;}
    #clock{font-size:32px;font-weight:700;text-align:right;}
    #clock .date{display:block;font-size:20px;font-weight:400;color:#dbeeff;margin-top:6px;}

    /* TABLE */
    .table-container{margin:20px 30px;}
    .table-wrapper{border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.5);}
    table{width:100%;border-collapse:collapse;table-layout:fixed;color:#fff;background:transparent;}
    thead th{
      background:var(--table-header);
      padding:22px 16px;
      font-size:28px;
      font-weight:800;
      text-align:center;
    }
    tbody td{
      padding:24px 18px;
      font-size:26px;
      text-align:center;
    }
    tbody tr:nth-child(odd) td{background:var(--cell-dark);}
    tbody tr:nth-child(even) td{background:var(--cell-dark-2);}

    /* FOOTER (running text) */
    .footer-note{
      background:rgba(0,0,0,0.85);
      color:var(--accent-yellow);
      font-weight:700;
      font-size:24px;
      padding:12px;
      overflow:hidden;
      white-space:nowrap;
      position:relative;
    }
    .footer-note span{
      display:inline-block;
      padding-left:100%;
      animation:scroll-left 20s linear infinite;
    }
    @keyframes scroll-left{
      0%{transform:translateX(0%);}
      100%{transform:translateX(-100%);}
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="left">
      <img src="paroki2.png" class="logo" alt="Logo Paroki">
      <div>
        <h1>Jadwal Penggunaan Ruangan</h1>
        <div class="subtitle">Paroki Santa Maria Assumpta Klaten</div>
      </div>
    </div>
    <div id="clock">--:--:--<span class="date">Memuat...</span></div>
  </header>

  <!-- TABLE -->
  <div class="table-container">
    <div class="table-wrapper">
      <table id="jadwal">
        <thead>
          <tr>
            <th style="width:14%">Tanggal</th>
            <th style="width:12%">Hari</th>
            <th style="width:12%">Jam</th>
            <th style="width:36%">Kegiatan</th>
            <th style="width:13%">Ruangan</th>
            <th style="width:13%">Penanggung Jawab</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="6" style="padding:30px;font-size:24px;">Memuat data...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer-note"><span id="pengumuman">Memuat pengumuman...</span></div>

<script>
/* === CONFIG URL SPREADSHEET (CSV) === */
const urlJadwal = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSIcQ-QfZhH-MGrWehxKCo8H-yyq0Ayt2ARrVr-ydGXtQ4xgu97_Rc3qccaquiqWDYO0ywKkWKrWRXi/pub?gid=0&single=true&output=csv";
const urlPengumuman = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSIcQ-QfZhH-MGrWehxKCo8H-yyq0Ayt2ARrVr-ydGXtQ4xgu97_Rc3qccaquiqWDYO0ywKkWKrWRXi/pub?gid=563346649&single=true&output=csv";

const rowsPerPage = 10;
const slideIntervalMs = 8000;
let jadwalRows = [];
let currentPage = 0;
let slideTimer = null;

/* CSV PARSER */
function parseCSV(text){
  const lines=text.split(/\r?\n/).filter(l=>l.trim()!=="");
  return lines.map(line=>{
    const row=[];let cur="";let inQuote=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='\"'){
        if(inQuote&&line[i+1]==='\"'){cur+='\"';i++;}
        else inQuote=!inQuote;
      } else if(ch===','&&!inQuote){row.push(cur);cur="";}
      else cur+=ch;
    }
    row.push(cur);
    return row;
  });
}

/* Hari dari tanggal */
function getHariFromDateString(s){
  if(!s) return "";
  s=s.trim();
  if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(s)){
    const [d,m,y]=s.split("/");
    const date=new Date(`${y}-${m}-${d}`);
    if(!isNaN(date)) return date.toLocaleDateString("id-ID",{weekday:"long"});
  }
  const d=new Date(s);
  return !isNaN(d)?d.toLocaleDateString("id-ID",{weekday:"long"}):"";
}

/* Render Page */
function renderPage(pageIndex){
  const tbody=document.querySelector("#jadwal tbody");
  if(jadwalRows.length===0){
    tbody.innerHTML="<tr><td colspan='6' style='padding:30px;font-size:24px;'>Tidak ada data</td></tr>";
    return;
  }
  const start=pageIndex*rowsPerPage;
  const slice=jadwalRows.slice(start,start+rowsPerPage);
  let html="";
  for(const r of slice){
    const tanggal=r[0]||"", jam=r[1]||"", acara=r[2]||"", ruang=r[3]||"", pic=r[4]||"";
    const hari=getHariFromDateString(tanggal);
    html+=`<tr>
      <td>${tanggal}</td>
      <td>${hari}</td>
      <td>${jam}</td>
      <td style="text-align:left;padding-left:20px">${acara}</td>
      <td>${ruang}</td>
      <td>${pic}</td>
    </tr>`;
  }
  tbody.innerHTML=html;
}

/* Slideshow */
function startSlideshow(){
  if(slideTimer){clearInterval(slideTimer);slideTimer=null;}
  if(jadwalRows.length<=rowsPerPage){currentPage=0;renderPage(0);return;}
  slideTimer=setInterval(()=>{
    currentPage++;
    const totalPages=Math.ceil(jadwalRows.length/rowsPerPage);
    if(currentPage>=totalPages) currentPage=0;
    renderPage(currentPage);
  },slideIntervalMs);
  currentPage=0;renderPage(0);
}

/* Load Jadwal */
function loadJadwal(){
  fetch(urlJadwal).then(r=>r.text()).then(txt=>{
    const parsed=parseCSV(txt);
    if(parsed.length===0){jadwalRows=[];startSlideshow();return;}
    const first=parsed[0][0]||"";
    if(!/^\d/.test(first)) parsed.shift(); // buang header
    jadwalRows=parsed.filter(r=>r.some(c=>(c||"").trim()!==""));
    startSlideshow();
  }).catch(err=>{
    document.querySelector("#jadwal tbody").innerHTML="<tr><td colspan='6' style='padding:30px;font-size:24px;'>Gagal memuat data</td></tr>";
  });
}

/* Load Pengumuman */
function loadPengumuman(){
  fetch(urlPengumuman).then(r=>r.text()).then(txt=>{
    const parsed=parseCSV(txt);
    if(parsed.length===0){document.getElementById("pengumuman").textContent="Tidak ada pengumuman";return;}
    parsed.shift();
    const texts=parsed.map(r=>(r[0]||"").trim()).filter(Boolean);
    document.getElementById("pengumuman").textContent=texts.length?texts.join(" â€¢ "):"Tidak ada pengumuman";
  }).catch(err=>{
    document.getElementById("pengumuman").textContent="Gagal memuat pengumuman";
  });
}

/* Clock */
function startClock(){
  const days=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
  const months=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
  function update(){
    const n=new Date();
    const t=n.toLocaleTimeString('id-ID',{hour:"2-digit",minute:"2-digit",second:"2-digit"});
    const dateStr=`${days[n.getDay()]}, ${String(n.getDate()).padStart(2,'0')} ${months[n.getMonth()]} ${n.getFullYear()}`;
    document.getElementById("clock").innerHTML=`${t}<span class="date">${dateStr}</span>`;
  }
  update();setInterval(update,1000);
}

/* INIT */
startClock();
loadJadwal();
loadPengumuman();
setInterval(loadJadwal,30000);
setInterval(loadPengumuman,30000);
</script>
</body>
</html>
